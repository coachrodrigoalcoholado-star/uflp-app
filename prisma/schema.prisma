generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id              String     @id @default(uuid())
  email           String     @unique
  password        String
  role            String     @default("STUDENT")
  firstName       String?
  lastNamePaterno String?
  lastNameMaterno String?
  dob             DateTime?
  sex             String?
  age             Int?
  birthPlace      String?
  address         String?
  city            String?
  state           String?
  country         String?
  zipCode         String?
  phone           String?
  landline        String?
  alternativeEmail String?
  profession      String?
  educationLevel  String?
  institution     String?
  currentOccupation String?
  profileCompleted  Boolean    @default(false)
  documentsCompleted Boolean   @default(false)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  documents       Document[]
  payments        Payment[]
  notifications   Notification[]
  cohortId        String?
  cohort          Cohort?    @relation(fields: [cohortId], references: [id])
  distributionUFLP       String   @default("PENDING")
  distributionUFLPDate   DateTime?
  distributionECOA       String   @default("PENDING")
  distributionECOADate   DateTime?
  distributionCommission String   @default("PENDING")
  distributionCommissionDate DateTime?
  resetToken      String?
  resetTokenExpiry DateTime?
  sedeNombre      String?
  entrenadorNombre String?
  entrenadorCelular String?
  uflpSent        Boolean    @default(false)

  @@index([cohortId])
  @@index([role])
  @@index([createdAt])
}

model Cohort {
  id        String   @id @default(uuid())
  code      String   @unique
  startDate DateTime
  endDate   DateTime
  users     User[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Document {
  id              String   @id @default(uuid())
  type            String
  url             String
  status          String   @default("PENDING")
  rejectionReason String?
  userId          String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model Payment {
  id              String   @id @default(uuid())
  amount          Float
  date            DateTime
  url             String?
  location        String?
  method          String?
  payerName       String?
  status          String   @default("PENDING")
  rejectionReason String?
  userId          String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id])
  distributionUFLP       String   @default("PENDING")
  distributionUFLPDate   DateTime?
  distributionECOA       String   @default("PENDING")
  distributionECOADate   DateTime?
  distributionCommission String   @default("PENDING")
  distributionCommissionDate DateTime?

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  type      String   // INFO, WARNING, ERROR, SUCCESS
  title     String
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model SystemSetting {
  key         String @id
  value       String
  description String?
  updatedAt   DateTime @updatedAt
}
